\chapter{INTRODUÇÃO} 
\label{cap:ini}
\vspace{-2cm}

Em qualquer sistema de comunicação deve-se garantir uma alta confiabilidade dos dados transmitidos, de forma que no lado do receptor sejam recebidos os mesmos dados enviado pelo transmissor. A forma de onda do sinal transmitido  é afetado por dois mecanismos básicos: todas as linhas de transmissão e circuitos possuem função de transferência não lineares no domínio da frequência e ruídos elétricos não desejáveis ou algum tipo de interferência que distorce o sinal enviado \cite[p.~3]{Sklar1988}. Em comunicações digitais e seriais de alta velocidade presentes em um ambiente com alto nível de radiação eletromagnética, o uso de transmissões por fibra óptica são mais adequadas para atingir o nível de performance exigido. Entretanto, transmissões em fibras ópticas estão sujeitas a perdas devido aos efeitos ópticos lineares e não-lineares. Os tipos de perda são: atenuação, dispersão, auto-modulação de fase, mistura de quatro ondas, espalhamento Brillouin Estimulado e espalhamento Raman estimulado \cite{ghatak1998}. 

Desta forma, em transmissões seriais de alta velocidade é empregado protocolos de comunicação para garantir a maior eficiência e o menor número de erros possível. Este tipo de implementação é extremamente útil em sistemas para física de altas energias. Nestes sistemas, há a presença de uma alta taxa de transmissão combinado com uma alta radiação eletromagnética e um interesse de uma alta confiabilidade no canal, implicando na necessidade de implementação de protocolos de comunicação. Estes protocolos possibilitam a introdução de sistemas para identificar e corrigir possíveis erros, além de possibilitar que circuitos externos sincronizem os dispositivos comunicantes.

\section{Motivação}

Este trabalho é parte de uma colaboração com o laboratório \textit{São Paulo Research and Analysis Center} (SPRACE) \cite{Sprace2019}. O laboratório SPRACE possui vários ramos de pesquisa, sendo uma delas a instrumentação eletrônica para os sistemas do LHC. Este possui uma extensão de 27 km de circunferência, localizado na fronteira Franco-Suiça, tendo por objetivo descobrir a origem da massa das partículas elementares e outras dimensões do espaço \cite{Wikipedia2019}. O colisor é o maior equipamento já construído para pesquisa em física de altas energias do mundo, obtendo resultados expressivos como a descoberta do Bóson de Higgs. Este Bóson é uma partícula elementar prevista pelo modelo padrão de partículas, que ajuda a explicar a massa de outras partículas elementares \cite{Randal2013}.

No percurso do colisor há 4 detectores : \textit{A Toroidal LHC ApparatuS} (ATLAS), \textit{Compact Muon Solenoid} (CMS), \textit{A Large Ion Collider} (Alice) e o \textit{LHC beauty} LHCb. O acelerador de partículas fornece velocidade e os detectores captam os produtos do impacto das partículas. Dessa forma, pode-se observar a existência de traços de partículas elementares que explicam teorias importantes sobre a física de altas energias \cite{Ferreira2009}. Na Figura \ref{lhc} é ilustrado um esquema do grande colisor de Hádrons que está localizado a 175 metros abaixo do solo.

%\begin{figure}[htbp]
\begin{figure}[H]
	\tiny \caption{\small Esquema do grande colisor de Hádrons (LHC). \label{lhc}}
	% o que está dentro do colchetes é o que aparecerá na lista de figuras.
	\vspace{-0.3 cm}
	\begin{center}
		\begin{psfrags}
			\epsfxsize=4cm
			\centerline{\includegraphics[width=16.0 cm]{./capitulo_1/lhc.eps}}
		\end{psfrags}
		{\small Fonte: Adaptado de \citeonline{esmaMobs}}
	\end{center}
\end{figure}


O grande colisor está em um processo de pesquisa para realizar uma grande atualização, a chamada Grande Luminosidade ou da sigla em inglês \textit{High Luminosity - Large Hadron Collider} (HL-LHC). Com isto é esperado um aumento no número médio de colisões próton-próton de 100 para em torno de 140 a 200, denominadas \textit{pileup} (PU). Estas colisões médias são obtidas pelo cruzamento de um grupo de prótons em uma frequência de 40MHz. Consequentemente, um grupo de prótons se cruza no ponto de colisão dentro do detector, para a cada 25ns \cite[p.~2]{Aggleton2017}.

Em cada um dos 4 detectores há um ponto de colisão sendo possível por monitorar os eventos decorrentes do choque d. Especificamente, o projeto descrito é idealizado para atuar no detector de propósito geral CMS. Este é um grande detector com o objetivo de investigar uma vasta variedade de fenômenos físicos. O detector possui uma solenóide supercondutora central de 6 metros de diâmetro, provendo um campo magnético de 3,8T. Na figura \ref{detecCMS} é ilustrado um esquemático do detector CMS \cite[p.~2]{Aggleton2017}.

%\begin{figure}[htbp]
\begin{figure}[H]
	\tiny \caption{\small Esquerda - Máquina do LHC. Direita - Sub-detectores do CMS \label{detecCMS}}
	% o que está dentro do colchetes é o que aparecerá na lista de figuras.
	\vspace{-0.3 cm}
	\begin{center}
		\begin{psfrags}
			\epsfxsize=4cm
			\centerline{\includegraphics[width=16.0 cm]{./capitulo_1/chambMuon.eps}}
		\end{psfrags}
		{\small Fonte: Adaptado de \citeonline[p.~19]{tomei}}
	\end{center}
\end{figure}
  
Pela figura \ref{detecCMS}, há vários componentes no colisor para a medição dos fenômenos ou elementos gerados pela colisão das partículas. Para o aumento na taxa de colisão, a instrumentação eletrônica presente no detector deverá ser atualizada para suportar o novo volume de dados gerados. Os sistemas desenvolvidos devem serem capazes de transmitir e processar um grande volume de dados em uma faixa muito curta de tempo \cite{Lucio2019}.

O trabalho desenvolvido pelo laboratório SPRACE está diretamente ligado ao detector Solenóide de Muon Compacto (CMS) do LHC. Os detectores do LHC tem estruturas diferentes e cada um obtém dados de partículas específicas. A junção de todos os dados de todos os detectores forma uma imagem completa do experimento, ajudando a realizar novas descobertas.

O detector CMS foi designado para registrar, direta ou indiretamente, o caminho e a energia de todos os modelos padrões de partículas resultantes da colisão \cite{tomei}. O detector é composto de várias camadas de sub-detectores especializados para medir as diferentes características das partículas produzidas, como ilustrado no lado direito da Figura \ref{detecCMS}. A instrumentação do CMS inclui diferentes componentes, dentre eles: \textit{Muon Chamber, Hadronic Calorimeter}(HCAL), \textit{Eletromagnetic Calorimeter} (ECAL) e o \textit{Silicon Tracker}. Dentro do detector há um solenóide supercondutor aplicando um alto campo magnético que é capaz de curvar a trajetória da partícula após a colisão. Portanto, quanto maior a energia da partícula menor a curvatura na sua trajetória \cite[p.~3]{Aggleton2017}.  

Pela análise do caminho e da energia da partícula, medida pelo \textit{Tracker}, \textit{muon chamber} e os calorímetros é possível reconstruir os eventos resultantes da colisão. Nos dispositivos de medição há uma pré-seleção para partículas com um limiar de momento transversal (pT) das partículas carregadas tipicamente mair do que 2 ou 3 Giga Eletrovolt (GeV). Entretanto, devido ao grande número de colisões os dados devem serem filtrados por questões de armazenamento e capacidade de transmissão. Assim, os dados passam por um filtro denominado \textit{Level 1  Track and Trigger} (L1TT). Este sistema faz e a reconstrução dos caminhos das partículas e seleciona os eventos que são interessantes para estudo.\cite{Aggleton2017}.

A colaboração entre o laboratório SPRACE com o CMS objetiva-se colaborar no desenvolvimento de sistemas na área da instrumentação eletrônica, o qual serão implementados dentro de um sistema completo de detecção. O novo sistema que está em desenvolvimento, principalmente objetiva-se eliminar as restrições de latência que o atual possui \cite{Cms2019}.

Para este propósito, foi desenvolvido um sistema chamado \textit{Low Power GigaBit Transceiver} (LpGBT) para transmitir dados coletados nos dispositivos eletrônicos do colisor pelos \textit{Front End module} (FE module), para um sistema responsável pela análise e seleção das amostras coletadas localizado fora do detector denominado \textit{Data, Trigger and Control} (DTC). Na Figura \ref{sysDTC} é descrito um esquema do sistema presente no colisor para a decisão dos eventos a serem armazenados, chamado L1TT. 

%\begin{figure}[htbp]
\begin{figure}[H]
	\tiny \caption{\small Descrição do sistema, fluxo de dados e especificação de latência por meio dos dispositivos eletrônicos fora do detector que formam a decisão do L1TT. \label{sysDTC}}
	% o que está dentro do colchetes é o que aparecerá na lista de figuras.
	\vspace{-0.3 cm}
	\begin{center}
		\begin{psfrags}
			\epsfxsize=4cm
			\centerline{\includegraphics[width=16.0 cm]{./capitulo_1/L1TT.eps}}
		\end{psfrags}
		{\small Fonte: \citeonline{Aggleton2017}}
	\end{center}
\end{figure}

No \textit{FE module} captura-se os dados da colisão das partículas. Esses dados são transmitidos para um sistema, fora do colisor, o \textit{Data, Trigger and Control} (DTC). Este sistema, acompanhado do \textit{Track Finder} e o \textit{L1 Correlator} gera a decisão de armazenar o dado coletado no colisor. O tempo total para a decisão de quais eventos medidos nos sensores do detector é de 12.5$\mu$s \cite[p.~4]{Aggleton2017}. 

O \textit{L1 correlator} necessita de 3.5$\mu$s para correlacionar os caminhos com dados primitivos do calorímetro e o sistema Muon e tomar a decisão se o evento é de interesse do estudo. A propagação da decisão do \textit{L1 correlator} para os buffers do \textit{FE module} leva mais 1$\mu$s, enquanto outros 3$\mu$s são necessários como margem de segurança. Isso significa que para as caminhos sejam utilizadas pelo  \textit{L1 correlator} para tomar a decisão, os eventos devem ser extraídos dos componentes eletrônicos do rastreador, organizados e feito a reconstrução das trilhas no \textit{Track Finder} em aproximadamente 5$\mu$s após a colisão. Em torno de 1$\mu$s é necessário para geração, empacotamento e transmissão dos eventos do \textit{FE module} para o DTC. Portanto, a latência de processamento para reconstruir os rastros a partir dos dados chegando ao DTC é fixado em 4$\mu$s \cite[p.~5]{Aggleton2017}.

Portanto, com o L1TT é possível selecionar os eventos físicos de interesse e reduzir a taxa de dados do detector. A redução é de 40MHz para um número menor do que 750kHz, sendo esta a máxima taxa que o sistema suporta. O transporte dos dados entre \textit{FE module} e o DTC, feito pelo \textit{LpGBT ASIC} e um FGPA com o protocolo LpGBT implementado, com uma latência tolerada de 1$\mu$s \cite[p.~4]{Aggleton2017}. 

No sistema L1TT há 3 sinais lógicos: \textit{Timing and Trigger Control} (TTC), \textit{Data Acquisition} (DAQ) e \textit{Slow Control} (SC). Estes sinais não necessitam possuir caminhos físicos diferentes, sendo possível transmiti-los em canal óptico através do LpGBT. Na figura \ref{schLpgbt} é ilustrado sistema usando o protocolo LpGBT em que pode-se observar a transmissão dos sinais lógicos. As cores dos sinais lógicos da Figura \ref{schLpgbt} representam as mesmas cores dos sinais lógicos da Figura \ref{sysDTC}.

%\begin{figure}[htbp]
\begin{figure}[H]
	\tiny \caption{\small Esquema do Sistema de comunicação Serial LpGBT.  \label{schLpgbt}}
	% o que está dentro do colchetes é o que aparecerá na lista de figuras.
	\vspace{-0.3 cm}
	\begin{center}
		\begin{psfrags}
			\epsfxsize=4cm
			\centerline{\includegraphics[width=16.0 cm]{./capitulo_1/lpgbtSchematic.eps}}
		\end{psfrags}
		{\small Fonte: \citeonline[p.~3]{lpgbt}}
	\end{center}
\end{figure}

O sistema FPGA com a implementação do LpGBT, o qual está fora do detector, já está descrito e implementado. Entretanto, o sistema LpGBT ASIC que fica alocado dentro do Detector, em uma região de alta radiação eletromagnética, ainda está em fase de desenvolvimento. Todavia, o sistema LpGBT dentro do detector está descrito em códigos de descrição de hardware, porém não são sintetizáveis em um FPGA. A grande motivação do trabalho é descrever o sistema LpGBT ASIC de uma forma que seja sintetizável em um FPGA.


\section{Descrição do Sistema LpGBT ASIC}

O lpGBT ASIC faz parte do chipset lpGBT composto pelos seguintes chips: um amplificador de impedância trans para o
receptor óptico (GBTIA/lpGBTIA-em desenvolvimento), um driver de diodo a laser quádruplo e o próprio lpGBT propriamente dito, um link ASIC que implementa todas as funções necessárias do transceptor de dados e tempo, além de um conjunto de funções necessárias para o controle do experimento.

Como descrito na Figura \ref{schLpgbt}, cada \textit{FE module} será atendido por um LpGBT ASIC, ao qual por um par de fibras ópticas, faz interface diretamente com o sistema DTC. Esses links ópticos poderão transferir dados do detector a 5.12 ou 10.24 Gb/s, fornecendo uma largura de banda eficaz entre 3.84 e 8.96 Gb/s, representando correção de erros e sobrecarga de protocolo. A comunicação entre os \textit{FE modules} e cada chip LpGBT suporta até 7 links de entrada-saída a 1.28 Gb/s e 8 Links de controle a 160Mb/s \cite{orfanelli}.

Aproximadamente 75\% dessa largura de banda será dedicada à leitura de dados dos eventos no detector a cada 25 ns. Os aproximadamente 25\% restantes da largura de banda da leitura do módulo serão dedicados à transmissão dos dados completos do evento, incluindo todas as faixas/pixels de acerto, acionados por um sinal de aceitação do \textit{L1 Correlator} \cite{Aggleton2017}. A arquitetura geral do lpGBT ASIC e suas principais conexões externas são exibidas na Figura . Em seu genérico configuração, o lpGBT se conecta a um driver de laser ASIC e a um amplificador de trans-impedância ASIC. Na figura é descrito a arquiterura do sistema LpGBT.

%\begin{figure}[htbp]
\begin{figure}[H]
	\tiny \caption{\small Arquitetura do LpGBT ASIC.  \label{arquLpgbt}}
	% o que está dentro do colchetes é o que aparecerá na lista de figuras.
	\vspace{-0.3 cm}
	\begin{center}
		\begin{psfrags}
			\epsfxsize=4cm
			\centerline{\includegraphics[width=16.0 cm]{./capitulo_1/archLpGBT.eps}}
		\end{psfrags}
		{\small Fonte: \citeonline[p.~5]{lpgbt}}
	\end{center}
\end{figure}

Pela Figura \ref{arquLpgbt}, na parte do \textit{downlink} há vários componentes essenciais para o sistema. Primeiramente, há o circuito de recuperação de dados, \textit{clock} e \textit{loop} de fase bloqueada (CDR/PLL) recebe dados seriais de alta velocidade (2.56 Gb/s). A partir dele, recupera e gera um relógio de alta velocidade apropriado para amostrar corretamente a entrada fluxo de dados. Os dados seriais são desserializados pelo \textit{Deserializer}(DeSER), ou seja, convertidos para paralelo e, em seguida, decodificado pelo \textit{decoder} (DEC), com as correções de erro apropriadas, e finalmente realiza-se o processo de desembaralhar o dado pelo \textit{Descrambler} (DSCR).

Na parte do \textit{uplink}, os dados a serem transmitidos são embaralhados pelo \textit{scrambler} (SCR), e então codificado com um código de correção de erro denominado \textit{forward Error Corretion} (FEC) antes de ser serializado pelo \textit{serializer} (SER) e enviado ao driver do laser. A configuração do driver do laser pode ser realizada através de uma conexão I2C do lpGBT. 

O \textit{Clk Manager} se encarrega de gerar e gerenciar os diferentes relógios de alta e baixa frequência necessários nas diferentes partes do ASIC. Um deslocador de fase programável está disponível para gerar 4 relógios de usuário externo com frequência programável (40 MHz a 1,28 GHz) e fase (rotação total de 360 graus em incrementos de fase de 50 ps). No modo Transceptor, um relógio externo deve, ou, pode ser usado para operação durante a inicialização como referência relógio para o SER ou como uma ajuda de travamento para o circuito CDR.

A lógica geral de controle e monitoramento cuida do controle das diferentes partes do chip de acordo com a operação modo selecionado e as informações de configuração do ASIC. As informações de configuração inicial são obtidas do chip on Fusíveis eletrônicos que podem ser modificados através do próprio link óptico ou de uma interface escrava I2C. 

As conexões com os módulos \textit{FE module} e o LpGBT ASIC são feitas através de conjuntos de links elétricos de saída/entrada (eLinks). Dependendo da taxa de dados e da mídia de transmissão usada, os eLinks permitem conexões que podem se estender até alguns metros. Os eLinks são direcionados por uma série de ePorts no LpGBT e estão associados às portas eLink nos módulos \textit{FE module}. O número de eLinks ativos e sua taxa de dados são programáveis.

Os ePorts de recebimento (ePortRx) são associados ao \textit{uplink} desserializam os dados recebidos dos módulos do \textit{FE module} ou ASICs para que possam ser embaralhados, codificados e montados no \textit{uplink} antes de serem transmitidos ao DTC. Cada ePortRx é associado a um \textit{Phase-Aligner} (PA) usado para garantir que os dados seriais recebidos dos \textit{FE module} são amostrados adequadamente no meio do diagrama de olho. Por outro lado, os ePorts do transmissor (ePortTx) são associado ao \textit{downlink} e o SER, recebidos do DTC, e transmitem dados aos dispositivos \textit{FE module} usando o eLinks. Por fim, os ePorts também têm eClocks associados. Esses relógios são programáveis em frequência, mas possuem fase fixa.

\section{TRABALHO DESENVOLVIDO}

No ambiente do detector há uma alta taxa de radiação eletromagnética, por conta da alta velocidade dos átomos presentes no tubo. Dessa forma, em transmissões de alta velocidade de uma placa para outra podem acarretar a presença de ruídos no canal de transmissão. Os ruídos presentes no canal de transmissão danificam os dados originais, acarretando no armazenamento de dados incoerentes para um posterior estudo. Portanto, a implementação de um protocolo de comunicação possibilita a detecção e correção de erros e a solução de problemas envolvidos na transmissão em altas velocidades.

Este trabalho desenvolve o estudo do protocolo de comunicação LpGBT e suas características por meio de uma descrição em VHDL e FPGA. Dessa forma, o sistema desenvolvido pode ser usado como codificação do canal de transmissão entre duas placas FPGA garantindo uma maior confiabilidade dos dados transmitidos.

O trabalho confeccionado foi dividido em ....
%7 partes. No \autoref{teo:filds} é apresentado uma noção geral sobre campos finitos, teoria essencial para o entendimento dos sistemas presentes na codificação. No \autoref{teo:lfsr} é apresentado a teoria dos \textit{Linear FeedBack Shift Registes (LFSR)}, componente essencial para os \textit{Cyclic Redundancy Check (CRC)} e os \textit{scramblers}. No \autoref{teo:scrambler} é apresentado a teoria dos \textit{scramblers}, sistemas essenciais para garantir o balanço entre os bits 1's e 0's na transmissão. No \autoref{crc:teoria} é apresentado a teoria dos CRC's, sendo os responsáveis pela detecção de erro no dado transmitido. A codificação 64b66b é descrita no \autoref{codificacao64b66b}, bem como todos os componentes para realizar a transmissão do dado. No \autoref{sys:teo} é apresentado a descrição do sistema desenvolvido com a codificação 64b66b. No \autoref{concu:teo} é apresentado algumas simulações e conclusões sobre o funcionamento do sistema desenvolvido.



A tabela abaixo é uma tabela de exemplo de ...

\begin{table}[htbp]
\begin{minipage}[b]{0.61\linewidth}
\begin{spacing}{-0.5} %Espaço entre o título e a tabela
\caption{Resultado para o sistema}
\label{tab:Resultado-Linear-DisjuntivoIEEE}
\end{spacing}
\end{minipage}
\begin{centering}
\begin{tabular}{c|c|c|c}
\cline{2-4}
\multicolumn{1}{c|}{} &   Estágio 1   &   Estágio 2   & Estágio 3    \tabularnewline
\hline
\multirow{3}{*}{}     &  $n_{6-10}=1$ & $n_{20-23}=1$ & $n_{1-5}=1$\tabularnewline
%\cline{2-4}
Número de linhas      &   $n_{7-8}=2$ &               & $n_{3-24}=1$\tabularnewline
%\cline{2-4}
      $n_{ij}$        & $n_{10-12}=1$ &               &             \tabularnewline
%\cline{2-4}
\multirow{3}{*}{}     & $n_{11-13}=1$ &               &             \tabularnewline
\hline
%\hline
\multicolumn{4}{c}{Função Objetivo $v$ = 220.2860}\tabularnewline
\hline
\multicolumn{4}{l}{\small{Fonte: Dados da pesquisa do autor.}}\tabularnewline
\end{tabular}
%\\
%{\small{Fonte: o próprio autor}}
\par\end{centering}
\end{table}

